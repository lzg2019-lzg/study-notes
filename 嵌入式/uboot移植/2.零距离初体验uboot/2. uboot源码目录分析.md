- [uboot的源码目录分析](#uboot%e7%9a%84%e6%ba%90%e7%a0%81%e7%9b%ae%e5%bd%95%e5%88%86%e6%9e%90)
  - [1.九鼎官方uboot和三星原版uboot对比](#1%e4%b9%9d%e9%bc%8e%e5%ae%98%e6%96%b9uboot%e5%92%8c%e4%b8%89%e6%98%9f%e5%8e%9f%e7%89%88uboot%e5%af%b9%e6%af%94)
  - [2.各文件介绍](#2%e5%90%84%e6%96%87%e4%bb%b6%e4%bb%8b%e7%bb%8d)
  - [3.各个文件夹介绍](#3%e5%90%84%e4%b8%aa%e6%96%87%e4%bb%b6%e5%a4%b9%e4%bb%8b%e7%bb%8d)

<br/>


## uboot的源码目录分析

### 1.九鼎官方uboot和三星原版uboot对比
+ 以九鼎官方的`uboot`为蓝本来学习的，以三星官方的这份做对照。
+ 不同版本的`uboot`或者同一版本不同人移植的`uboot`，可能目录结构和文件内容都有所不同。自己移植时也可以根据需要去添加/删除/更改目录结构。
+ 九鼎在以三星的`uboot`为原材料进行移植时，把三星版本的`uboot`中很多不必要的文件夹，文件给删除掉了。这个删除把很多完全用不到的文件清除出去，减少了整体的文件数量，便于工作。
  
### 2.各文件介绍
+ `.gitgnore`：git工具的文件。
+ `arm-config.mk`：后缀是.mk，是一个`Makefile`文件。会被其他`Makefile`文件调用。
+ 三个`Changelog`文件：修改记录文件，该文件记录了这个`uboot`项目的版本变迁以及每个版本较上个版本修改的记录。正式的项目都有这些记录。主要给维护 `uboot`的人用。
+ `confog.mk`和`arm_config.mk`差不多性质。
+ `COPYING`：版本声明，`uboot`本身是`GPL`许可证的。
+ `CREDITS`：鸣谢，里面记录了对`uboot`有贡献的人，感谢目录。
+ `image_split`：一个脚本，看说明是用来分割`uboot.bin`到`BL1`的。
+ `MAINTAINERS`：维护者，就是当前参与维护`uboot`源码的社区工作者。
+ `MAKEALL`：一个脚本，应该是帮助编译`uboot`的。
+ `Makefile`：这个很重要，是`uboot`源代码的主`Makefile`，将来整个`uboot`被编译时就是用这个`Makefile`管理编译的。
+ `mk`：快速编译的脚本，其实就是先清理然后配置然后编译。
+ `mkmovi`：一个脚本，和`iNand/SD`卡启动有关。
+ `README`：所有的软件都有`README`，简单的使用说明书。
+ `rules.mk`：这个文件是我们`uboot`的`Makefile`使用的规则。

**总结：** 以上这些文件中，对我们比较重要，需要认真看的有2个：`mkconfig`和`Makefile`。一个负责`uboot`的配置，一个负责编译。

### 3.各个文件夹介绍
+ `api`：硬件无关的功能函数的API。`uboot`移植时不用管，这些函数是`uboot`本身使用的。
+ `api_example`：API相关的测试示例代码。
+ `board`：`board`文件夹下每一个文件都代表一个开发板，这个文件夹下面放的文件就是用来描述这一开发板的信息的。`board`目录下有多少个文件夹，就表示当前这个`uboot`已经被移植到多少个开发板上了（当前的uboot支持多少个开发板)。
  <br/>
    ><font face="仿宋">开发板越来越多，board目录下文件夹越来越多不方便管控。于是乎uboot就新增了一种机制，可以在board目录下不直接放开发板目录，而是在board下放厂家目录（vendor目录，以具体芯片厂商名字命名），然后将这个IC厂商的所有芯片开发板都丢到这个vendor目录下面去。所以大家会发现我们X210对应的开发板目录在board/samsung/x210。多了这层目录会影响配置阶段，在uboot的配置阶段要注意配置时的路径深度和实际存放要对应，不然配置后编译时找不到文件编译就会失败。注意一个细节就是历史原因造成的兼容性麻烦。最开始时board目录下就是开发板名字，后来才改成厂商名字的。但是因为要向前兼容，同一个厂商原来还是外面的开发板并没有挪移到厂商目录下面去。这样就造成后来的人不知道原委的感到很奇怪，感觉很混乱。</font>
  

  **注意：**`uboot`的配置阶段（其实就是根目录下面的`mkconfig`脚本和`Makefile`中配置有关的部分）主要解决的问题就是在可移植性领域能够帮助我们确定具体的文件夹的路径，然后编译时可以找到应该找到的文件，才能编译成功。因此`uboot`目录下的不同会造成配置时的不同。如果移植时没注意这里肯定要失败。

+ `common`：这个文件夹下放的是一些与具体硬件无关的普遍适用的一些代码。譬如控制台实现，crc校验等。但主要是两类：一类是`cmd`开头的，是用来实现`uboot`的命令系统；另一类是`env`开头的，是用来实现环境变量的。
+ `cpu`：这个目录是`SoC`相关的，里面存放的代码都是`SoC`相关初始化和控制代码（譬如`cpu`的，中断的，串口等`SoC`内部外设的，包括起始代码`start.s`也在这里）。里面有很多子文件夹，每一个子文件夹就是一个`SoC`系列。
  **注意：**这个文件夹是严格和硬件相关的，因此移植时也是要注意的。但是因为这个文件夹内都是`SoC`有关的，我们自己开发板和三星的开发板虽然板子设计不同但是`SoC`都是同一个，因此实际移植时这个目录几乎不用动。
+ `disk`：磁盘有关的。
+ `doc`：文档目录，里面存放了很多`uboot`相关文档，这些文档可以帮助我们理解`uboot`代码。
+ `driver`：驱动。从`linux`源代码中扣出来原封不动的`linux`设备驱动，主要是开发板上必须用到的一些驱动，如网卡驱动，`iNand/SD`卡，`NandFlash`等的驱动。（`uboot`中的驱动其实就是`linux`中的驱动，`uboot`在一定程序上移植了`linux`的驱动给自己用。但是`linux`是操作系统而`uboot`只是裸机程序，因此这种移植会有不同，`uboot`中的驱动其实是`linux`中的驱动的一部分）
+ `example`：示例代码。
+ `fs`：文件系统也是从`linux`源代码中移植过来的，用来管理`Flash`等资源。
+ `include`：头文件目录。
+ `lib`开头的一索。（典型的`lib_arm`和`lib_generic`）架构相关的库文件。譬如`lib_arm`里面就是`arm`架构使用的一些库文件。`lib_generic`里是所有架构通用的库文件。这类文件夹中的内容移植时基本不用管。
+ `libfdt`：设备树有关的。`linux`内核在`3.4`左右的版本时候更改了启动传参的机制，改用设备树来进行启动传参，进行硬件信息的描述了。
+ `nand_spl`：`nand`相关的。
+ `net`：网络相关的代码，譬如`uboot`中的`tftp, nfs, ping`命令。
+ `onenand`开头的，是`onenand`相关的代码，是三星加的，标准`uboot`中应该没有的。
+ `post`：不知道。
+ `sd_fusing`：这里面代码实现了烧录`uboot`镜像到`sd`卡的代码。
+ `tools`：工具类代码，譬如`mkimage`。

**总结：** 文件夹里比较重要的有：`board, common, cpu, drivers, include, lib_arm, lib_generic, sd_fusing`